<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IT Tycoon</title>
    <style>
    body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        display: grid;
        grid-template-areas:
            "header header"
            "tickets engineers"
            "actions actions"
            "progress progress";
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        padding: 20px;
        background-color: #e8f5e9; /* Changed to Light Green */
        color: #333;
        
        /* --- CENTERING THE BOXES --- */
        max-width: 1000px; /* Set a maximum width for the whole content area */
        margin: 0 auto; /* Center the content area horizontally */
        /* --------------------------- */
    }
    header {
        grid-area: header;
        text-align: center;
        border-bottom: 2px solid #ddd;
        padding-bottom: 10px;
    }
    h1, h2 {
        margin: 0;
    }
    #stats {
        font-size: 1.2em;
        font-weight: bold;
        color: #27ae60;
    }
    .container {
        background-color: #ffffff;
        border-radius: 8px;
        padding: 20px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
    }
    
    #tickets { 
        grid-area: tickets;
        background-color: #fffac8; 
        border: 1px solid #f1c40f; 
    }
    
    #engineers { grid-area: engineers; }
    #in-progress { grid-area: progress; }
    #actions { grid-area: actions; text-align: center; }

    .ticket, .engineer {
        border: 1px solid #ccc;
        border-radius: 5px;
        padding: 10px;
        margin-bottom: 10px;
        cursor: pointer;
        transition: all 0.2s ease;
        background-color: #ffffff; 
    }
    .ticket:hover, .engineer.idle:hover {
        border-color: #3498db;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }
    .engineer.idle {
        background-color: #e8f5e9; 
    }
    .engineer.working {
        background-color: #fff8e1; 
        cursor: not-allowed;
        opacity: 0.7;
    }
    
    /* Selection highlight */
    .ticket.selected, .engineer.selected {
        background-color: #f7cac9; /* Light Red/Pink for unified Selection */
        border: 2px solid #e74c3c;
    }
    
    .progress-bar {
        width: 100%;
        background-color: #eee;
        border-radius: 5px;
        height: 20px;
        margin-top: 5px;
        overflow: hidden;
    }
    .progress-fill {
        height: 100%;
        background-color: #2ecc71;
        width: 0%;
        transition: none; 
    }
    
    /* Button Styling */
    button {
        width: 100%; 
        padding: 12px 10px; 
        background-color: #2ecc71; 
        color: white;
        border: 2px solid #2ecc71; 
        border-radius: 4px; 
        font-size: 1em;
        font-weight: bold;
        cursor: pointer;
        margin-top: 10px;
        text-transform: uppercase;
        letter-spacing: 1px;
        transition: background-color 0.2s, border-color 0.2s;
    }
    button:hover:not(:disabled) {
        background-color: #27ad60; 
        border-color: #27ad60;
    }
    button:disabled {
        background-color: #cccccc;
        border-color: #cccccc;
        cursor: not-allowed;
    }
    .hire-button-1 { background-color: #2ecc71; border-color: #2ecc71;} 
    .hire-button-2 { background-color: #f1c40f; border-color: #f1c40f; } 
    .hire-button-3 { background-color: #e67e22; border-color: #e67e22; } 
    .hire-button-1:hover:not(:disabled) { background-color: #27ad60; border-color: #27ad60; }
    .hire-button-2:hover:not(:disabled) { background-color: #f39c12; border-color: #f39c12; }
    .hire-button-3:hover:not(:disabled) { background-color: #d35400; border-color: #d35400; }

    #assign-button {
        background-color: #e74c3c; 
        border-color: #e74c3c;
        font-size: 1.3em;
        width: 60%;
        margin: 10px auto; 
        display: block;
    }
    #assign-button:hover:not(:disabled) {
        background-color: #c0392b;
        border-color: #c0392b;
    }
    #new-ticket-btn {
        background-color: #3498db;
        border-color: #3498db;
        margin-bottom: 10px;
    }
    #new-ticket-btn:hover:not(:disabled) {
        background-color: #2980b9;
        border-color: #2980b9;
    }
    /* Style for the new control */
    #ticket-speed-control {
        display: flex;
        flex-direction: column;
        gap: 5px;
        margin-bottom: 10px;
        padding: 5px 0;
        border-bottom: 1px solid #ddd;
    }
    #ticket-speed-control label {
        font-weight: bold;
        font-size: 0.9em;
    }
    #ticket-speed-selector {
        padding: 8px;
        border-radius: 5px;
        border: 1px solid #ccc;
        background-color: #ffffff;
    }
</style>
</head>
<body>

    <header>
        <h1>My IT Company 📈</h1>
        <div id="stats">Money: $500 | Total Tickets Fixed: 0</div>
    </header>

    <div id="tickets" class="container">
        <h2>Available Tickets</h2>
                <div id="ticket-speed-control">
            <label for="ticket-speed-selector">Auto-Generate Speed:</label>
            <select id="ticket-speed-selector" onchange="updateTicketGenerationSpeed(this.value)">
                <option value="20000">Slow (1 per 20s)</option>
                <option value="15000" selected>Medium (1 per 15s)</option>
                <option value="10000">Fast (1 per 10s)</option>
                <option value="5000">Crazy (1 per 5s)</option>
            </select>
        </div>
        <button id="new-ticket-btn">Generate New Ticket Instantly</button>
        <div id="ticket-list"></div>
    </div>

    <div id="engineers" class="container">
        <h2>Engineers</h2>
        <div id="engineer-list"></div>
        <button class="hire-button-1" onclick="attemptHire(1)">Hire Junior (Skill 1) - $50</button>
        <button class="hire-button-2" onclick="attemptHire(2)">Hire Junior II (Skill 2) - $100</button>
        <button class="hire-button-3" onclick="attemptHire(3)">Hire Mid-Level (Skill 3) - $150</button>
    </div>

    <div id="actions">
        <button id="assign-button" onclick="assignSelectedWork()" disabled>Select Ticket & Engineer to Assign 👷</button>
    </div>

    <div id="in-progress" class="container">
        <h2>Tickets In Progress</h2>
        <div id="progress-list"></div>
    </div>

<script>
    // --- GAME STATE ---
    let state = {
        company: {
            money: 500, 
            totalTicketsFixed: 0,
        },
        engineers: [
            { id: 1, name: "Alice", skill: 1, status: 'idle', ticketsFixed: 0, assignedTicket: null },
            { id: 2, name: "Bob", skill: 1, status: 'idle', ticketsFixed: 0, assignedTicket: null },
        ],
        inProgressTickets: [], 
        tickets: [],
        nextTicketId: 1,
        nextEngineerId: 3,
        selectedTicket: null,
        selectedEngineer: null
    };

    // --- CONSTANTS ---
    const TICKET_PAY_PER_STAR = 20; 
    const PROGRESS_TO_COMPLETE = 100;
    const PROMOTION_THRESHOLD = 5; 
    const HIRE_COSTS = { 1: 50, 2: 100, 3: 150 }; 
    const HOURLY_SALARIES = { 1: 10, 2: 15, 3: 20, 4: 25, 5: 30 };
    const JUNIOR_ENGINEER_NAMES = ["Charlie", "Dana", "Eve", "Frank", "Grace", "Henry", "Ivy", "Jack"];
    
    // --- GIF ASSETS ---
    const GIFS = {
        WORKING: 'https://gifdb.com/images/file/working-emoji-typing-gf7f51a0cl5ynyx9.gif', // Image of person typing/working
        IDLE: 'https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExNmtpZ2VkcGg4cGRjM2J2aDVzYmR5cjQ1c2Fvb2o0bXRwd3d6ZzQyMCZlcD12MV9pbnRlcm5hbF9naWYmY3Q9cw/9RNGg4IQn0Qy4/giphy.gif' // Image of finger tapping/waiting
    };
    
    // Interval variables
    let gameInterval;
    let ticketInterval;
    
    // Rename elements for simplicity
    const ticketListEl = document.getElementById('ticket-list');
    const engineerListEl = document.getElementById('engineer-list');
    const progressListEl = document.getElementById('progress-list');
    const statsEl = document.getElementById('stats');
    const newTicketBtn = document.getElementById('new-ticket-btn');
    const assignBtn = document.getElementById('assign-button'); 

    // --- HELPER FUNCTIONS ---

    function getEngineerTitle(skill) {
        switch (skill) {
            case 1: return 'Junior I';
            case 2: return 'Junior II';
            case 3: return 'Mid-Level';
            case 4: return 'Senior';
            case 5: return 'Principal';
            default: return 'Trainee';
        }
    }

    function getRandomName() {
        const usedNames = state.engineers.map(e => e.name);
        const availableNames = JUNIOR_ENGINEER_NAMES.filter(name => !usedNames.includes(name));
        
        return availableNames.length > 0
            ? availableNames[Math.floor(Math.random() * availableNames.length)]
            : `Engineer ${state.nextEngineerId}`;
    }
    
    /** Updates the visibility and text of the Assign button */
    function updateAssignmentButton() {
        const ticketSelected = state.selectedTicket !== null;
        const engineerSelected = state.selectedEngineer !== null;

        // The button is no longer strictly needed for assignment, but we'll use it for status
        if (ticketSelected && engineerSelected) {
            const engineer = state.engineers.find(e => e.id === state.selectedEngineer);
            if (engineer && engineer.status === 'idle') {
                assignBtn.disabled = false;
                assignBtn.textContent = `Assignment Ready: Click to Assign! 🛠️`;
                // NOTE: We don't actually rely on this button click anymore.
            } else {
                assignBtn.disabled = true;
                assignBtn.textContent = 'Engineer is busy or already selected.';
            }
        } else {
            assignBtn.disabled = true;
            assignBtn.textContent = 'Select Ticket & Engineer to Assign 👷';
        }
    }

    // --- GAME LOGIC ---

    /** Generates a new random ticket */
    function generateTicket() {
        const complexity = Math.floor(Math.random() * 5) + 1; // 1 to 5
        const newTicket = {
            id: state.nextTicketId++,
            complexity: complexity,
            progress: 0,
        };
        state.tickets.push(newTicket);
        renderTickets();
    }

    /** * Handles selecting a ticket. If an engineer is already selected,
     * this triggers the instant assignment.
     */
    function selectTicket(ticketId) {
        // Toggle ticket selection
        state.selectedTicket = ticketId === state.selectedTicket ? null : ticketId; 
        
        // Check for instant assignment
        if (state.selectedTicket && state.selectedEngineer) {
            assignSelectedWork();
        }

        render();
        updateAssignmentButton();
    }

    /** * Handles selecting an engineer. If a ticket is already selected,
     * this triggers the instant assignment.
     */
    function selectEngineer(engineerId) {
        const engineer = state.engineers.find(e => e.id === engineerId);
        
        if (engineer.status === 'idle') {
            // Toggle engineer selection
            state.selectedEngineer = engineerId === state.selectedEngineer ? null : engineerId; 

            // Check for instant assignment
            if (state.selectedTicket && state.selectedEngineer) {
                assignSelectedWork();
            }

            render();
            updateAssignmentButton();
        } else {
            alert("This engineer is already working!");
        }
    }

    /** * Triggered by the combined selection of a ticket and an engineer.
     * Note: The HTML button function assignSelectedWork() is left intact for now, 
     * but the logic is now primarily triggered by selection handlers.
     */
    function assignSelectedWork() {
        // Only proceed if BOTH are selected and the engineer is idle
        if (!state.selectedTicket || !state.selectedEngineer) return;

        const ticketIndex = state.tickets.findIndex(t => t.id === state.selectedTicket);
        const engineer = state.engineers.find(e => e.id === state.selectedEngineer);
        const ticket = state.tickets[ticketIndex];

        if (ticket && engineer && engineer.status === 'idle') {
            // Assign
            engineer.status = 'working';
            engineer.assignedTicket = ticket.id;
            ticket.engineerId = engineer.id; 
            
            // Move ticket from 'available' to 'inProgress'
            state.inProgressTickets.push(ticket);
            state.tickets.splice(ticketIndex, 1);
            
            // Clear selections
            state.selectedTicket = null;
            state.selectedEngineer = null;
            
            render();
        }
    }

    /** Handles hiring a new engineer at a specific skill level */
    function attemptHire(skillLevel) {
        const cost = HIRE_COSTS[skillLevel];
        if (state.company.money < cost) {
            alert(`You need $${cost} to hire a ${getEngineerTitle(skillLevel)}!`);
            return;
        }

        state.company.money -= cost;
        
        const newEngineer = {
            id: state.nextEngineerId++,
            name: getRandomName(),
            skill: skillLevel, 
            status: 'idle',
            ticketsFixed: 0,
            assignedTicket: null
        };
        state.engineers.push(newEngineer);
        render();
    }

    /** Finalizes a ticket and calculates the variable payment */
    function completeTicket(engineer, ticket) {
        const payment = (ticket.complexity * TICKET_PAY_PER_STAR);
        state.company.money += payment;
        state.company.totalTicketsFixed++;
        
        engineer.ticketsFixed++;
        engineer.status = 'idle';
        engineer.assignedTicket = null;
        
        // Check for promotion
        if (engineer.ticketsFixed % PROMOTION_THRESHOLD === 0 && engineer.skill < 5) {
            engineer.skill++;
            alert(`${engineer.name} has been promoted to ${getEngineerTitle(engineer.skill)}! 🎉`);
        }

        renderStats();
    }
    
    /** The main game loop, runs every two seconds (representing a day/cycle) */
    function gameLoop() {
        let dailySalaryCost = 0;

        // 1. Process Ticket Progress
        state.inProgressTickets.forEach(ticket => {
            const engineer = state.engineers.find(e => e.id === ticket.engineerId);
            if (!engineer) return; 

            const progressThisTick = (engineer.skill * 5) / ticket.complexity;
            ticket.progress += progressThisTick;

            if (ticket.progress >= PROGRESS_TO_COMPLETE) {
                completeTicket(engineer, ticket);
            }
        });

        // 2. Deduct Daily Salaries (Operating Costs)
        state.engineers.forEach(engineer => {
            const salary = HOURLY_SALARIES[engineer.skill] || 5;
            dailySalaryCost += salary;
        });

        state.company.money -= dailySalaryCost;
        
        // 3. Clean up and Render
        state.inProgressTickets = state.inProgressTickets.filter(t => t.progress < PROGRESS_TO_COMPLETE);

        renderProgress();
        renderEngineers(); 
        renderStats();
    }
    
    /** Resets and starts the ticket generation interval based on user selection */
    function updateTicketGenerationSpeed(intervalMs) {
        if (ticketInterval) {
            clearInterval(ticketInterval);
        }
        ticketInterval = setInterval(generateTicket, parseInt(intervalMs, 10));
    }


    // --- RENDERING FUNCTIONS ---
    
    /** Renders everything */
    function render() {
        renderTickets();
        renderEngineers();
        renderProgress();
        renderStats();
        updateAssignmentButton(); 
    }

    /** Updates the available ticket list */
    function renderTickets() {
        ticketListEl.innerHTML = '';
        if (state.tickets.length === 0) {
            ticketListEl.innerHTML = '<p>No new tickets. Generate one manually or wait for the automatic generator!</p>';
        }
        state.tickets.forEach(ticket => {
            const selectedClass = ticket.id === state.selectedTicket ? 'selected' : '';
            const expectedPay = ticket.complexity * TICKET_PAY_PER_STAR; 
            ticketListEl.innerHTML += `
                <div class="ticket ${selectedClass}" onclick="selectTicket(${ticket.id})">
                    <strong>Ticket #${ticket.id}</strong>
                    <p>Complexity: ${'★'.repeat(ticket.complexity)}${'☆'.repeat(5 - ticket.complexity)}</p>
                    <p>Reward: $${expectedPay}</p>
                </div>
            `;
        });
    }

    /** Updates the engineer list */
    function renderEngineers() {
        engineerListEl.innerHTML = '';
        state.engineers.forEach(eng => {
            const selectedClass = eng.id === state.selectedEngineer ? 'selected' : ''; 
            const fullName = `${eng.name} (${getEngineerTitle(eng.skill)})`;
            const salaryCost = HOURLY_SALARIES[eng.skill] || '??';
            
            // Determine which GIF to show based on status
            const gifUrl = eng.status === 'working' ? GIFS.WORKING : GIFS.IDLE;

            engineerListEl.innerHTML += `
                <div class="engineer ${eng.status} ${selectedClass}" onclick="selectEngineer(${eng.id})">
                    <img src="${gifUrl}" alt="${eng.status}" style="width: 50px; height: 50px; float: right; margin-left: 10px;">
                    <strong>${fullName}</strong>
                    <p>Skill: ${'✦'.repeat(eng.skill)}${'✧'.repeat(5 - eng.skill)} (Salary: $${salaryCost}/Day)</p>
                    <p>Status: ${eng.status === 'idle' ? 'Idle 🟢' : `Working on Ticket #${eng.assignedTicket} 🟡`}</p>
                    <p>Tickets Fixed: ${eng.ticketsFixed}</p>
                </div>
            `;
        });
    }

    /** Updates the in-progress list, which includes the graphical progress bar */
    function renderProgress() {
        progressListEl.innerHTML = '';
        if (state.inProgressTickets.length === 0) {
            progressListEl.innerHTML = '<p>No tickets being worked on. Assign one now!</p>';
            return;
        }
        state.inProgressTickets.forEach(ticket => {
            const engineer = state.engineers.find(e => e.id === ticket.engineerId);
            const progressPercent = Math.min(100, (ticket.progress / PROGRESS_TO_COMPLETE) * 100);
            progressListEl.innerHTML += `
                <div class="ticket" data-ticket-id="${ticket.id}">
                    <strong>Ticket #${ticket.id} (Complexity: ${ticket.complexity})</strong>
                    <p>Assigned to: ${engineer ? engineer.name + ' (' + getEngineerTitle(engineer.skill) + ')' : '???'}</p>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${progressPercent}%"></div>
                    </div>
                    <p>${Math.floor(progressPercent)}% complete</p>
                </div>
            `;
        });
    }

    /** Updates the main company stats */
    function renderStats() {
        statsEl.innerHTML = `Money: $${Math.floor(state.company.money)} | Total Tickets Fixed: ${state.company.totalTicketsFixed}`;
    }

    // --- INITIALIZE ---
    newTicketBtn.addEventListener('click', generateTicket);
    
    // Expose global functions for onclick in HTML
    window.attemptHire = attemptHire;
    window.selectTicket = selectTicket;
    window.selectEngineer = selectEngineer;
    window.assignSelectedWork = assignSelectedWork; 
    window.updateTicketGenerationSpeed = updateTicketGenerationSpeed; 
    
    // Start the game
    state.company.money = 500; 
    generateTicket(); 
    render();
    
    // Start Game Loop (2 seconds)
    gameInterval = setInterval(gameLoop, 2000); 
    
    // Start automatic ticket generation with default (Medium: 15 seconds)
    updateTicketGenerationSpeed(document.getElementById('ticket-speed-selector').value);
</script>
</body>
</html>
